<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quotation {{ quotation_number }}</title>
    <style>
        /* Reset and base styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif; /* Universal font for all elements */
        }
        
        /* Page setup */
        @page {
            size: A4;
            margin: 0;
        }
        
        html, body {
            font-size: 12pt;
            line-height: 1.5;
            color: #333;
            background: #fff;
        }
        
        /* Main container with margins */
        .quotation-container {
            width: 210mm;
            max-width: 210mm;
            min-height: 297mm;
            margin: 0 auto;
            padding: 20mm 30mm 20mm 30mm; /* Equal padding on left and right */
            position: relative;
        }
        
        /* Header styles */
        .header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            width: 100%;
        }
        
        .logo-section {
            display: flex;
            align-items: center;
            flex: 2;
        }
        
        .logo-section img {
            max-width: 100px;
            max-height: 100px;
            margin-right: 15px;
        }
        
        .company-info {
            text-align: right;
            flex: 1;
        }
        
        .company-info p {
            margin-bottom: 5px;
            font-size: 10pt;
            word-wrap: break-word;
            overflow-wrap: break-word;
            white-space: normal;
            line-height: 1.4;
            max-width: 220px;
            margin-left: auto; /* Right align the text block */
        }
        
        /* Title */
        .quote-title {
            font-size: 24pt;
            text-align: center;
            margin-bottom: 30px;
            color: #2c3e50;
        }
        
        /* Client and quote info */
        .quote-meta {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
        }
        
        .client-info {
            flex: 1;
            max-width: 60%;
        }
        
        .quote-info {
            flex: 1;
            text-align: right;
            max-width: 40%;
        }
        
        .quote-info p {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 5px;
        }
        
        .quote-info p strong {
            margin-right: 5px;
        }
        
        .client-info p, .quote-info p {
            margin-bottom: 5px;
            word-wrap: break-word;
            overflow-wrap: break-word;
            white-space: normal;
            hyphens: auto;
        }
        
        /* Special styling for address fields */
        .address-line {
            max-width: 250px;
            line-height: 1.4;
            white-space: normal;
            word-wrap: break-word;
            overflow-wrap: break-word;
            hyphens: auto;
        }
        
        /* Table styles */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
            table-layout: fixed;
        }
        
        th {
            background-color: #2c3e50;
            color: white;
            padding: 10px;
            text-align: left;
            font-size: 11pt;
        }
        
        td {
            padding: 10px;
            border-bottom: 1px solid #ddd;
            word-wrap: break-word;
            overflow-wrap: break-word;
            white-space: normal;
            vertical-align: top;
            font-size: 11pt;
            line-height: 1.4;
        }
        
        /* Adjust table column widths for better balance */
        th:nth-child(1), td:nth-child(1) { width: 8%; text-align: center; }
        th:nth-child(2), td:nth-child(2) { 
            width: 42%; 
            white-space: normal; 
            word-wrap: break-word;
            overflow-wrap: break-word;
            hyphens: auto;
        }
        th:nth-child(3), td:nth-child(3) { width: 15%; text-align: center; }
        th:nth-child(4), td:nth-child(4) { width: 17%; text-align: right; white-space: nowrap; }
        th:nth-child(5), td:nth-child(5) { width: 18%; text-align: right; white-space: nowrap; }
        
        /* Terms and totals section - adjust for better balance */
        .terms-totals {
            display: flex;
            justify-content: space-between;
            margin-bottom: 40px;
        }
        
        .terms-section {
            flex: 2; /* Adjusted from 3 to 2 for better balance */
            padding-right: 30px;
        }
        
        .terms-heading {
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .terms-list {
            list-style-type: none;
            padding-left: 0;
            margin-top: 5px;
        }
        
        .terms-list li {
            margin-bottom: 5px;
            word-wrap: break-word;
            overflow-wrap: break-word;
            white-space: normal;
            hyphens: auto;
            line-height: 1.4;
            max-width: 350px;
        }
        
        .notes-section {
            margin-top: 20px;
        }
        
        .totals-section {
            flex: 1;
        }
        
        .total-row {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
        }
        
        .grand-total {
            font-weight: bold;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 2px solid #333;
        }
        
        /* Footer */
        .footer {
            margin-top: 60px;
            padding-bottom: 20px;
            display: flex;
            justify-content: flex-end; /* Align to right */
        }
        
        .prepared-by {
            width: 200px;
            text-align: center;
            border-top: 1px solid #333;
            padding-top: 10px;
            margin-right: 0; /* Ensure it's aligned all the way to the right */
        }
        
        .prepared-by p {
            margin-bottom: 3px;
        }
        
        /* Print specific styles */
        @media print {
            html, body {
                width: 210mm;
                height: 297mm;
            }
            
            .quotation-container {
                width: 210mm;
                height: 297mm;
                margin: 0;
                padding: 20mm 30mm 20mm 30mm; /* Equal padding on left and right for print */
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            
            /* Ensure consistent colors when printing */
            th {
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            
            /* Prevent awkward page breaks */
            table { page-break-inside: avoid; }
            .terms-totals { page-break-inside: avoid; }
            .footer { page-break-inside: avoid; }
        }
    </style>
</head>
<body>
    <div class="quotation-container">
        <!-- Header with logo and company info -->
        <div class="header">
            <div class="logo-section">
                <img src="{{ env.COMPANY_LOGO_URL }}" alt="Company Logo" width="{{ env.COMPANY_LOGO_WIDTH }}" height="{{ env.COMPANY_LOGO_HEIGHT }}">
                <div>
                    <h2>{{ env.COMPANY_NAME }}</h2>
                    {% if env.COMPANY_SUFFIX %}
                    <p>{{ env.COMPANY_SUFFIX }}</p>
                    {% endif %}
                </div>
            </div>
            <div class="company-info">
                <p>{{ env.COMPANY_ADDRESS }}</p>
                <p>{{ env.COMPANY_EMAIL }}</p>
                <p>{{ env.COMPANY_PHONE }}</p>
            </div>
        </div>

        <!-- Quotation title -->
        <div class="quote-title">Price Quote</div>

        <!-- Client and quotation info -->
        <div class="quote-meta">
            <div class="client-info">
                <p><strong>Quotation for:</strong></p>
                <p>{{ client_company }}</p>
                <p class="address-line">{{ client_address }}</p>
                <p>{{ client_contact }}</p>
                <p>{{ client_phone }}</p>
                <p>{{ client_email }}</p>
            </div>
            <div class="quote-info">
                <p><strong>Date:</strong> <span>{{ quotation_date }}</span></p>
                <p><strong>Quotation #:</strong> <span>{{ quotation_number }}</span></p>
                <p><strong>Valid until:</strong> <span>{{ expiry_date }}</span></p>
            </div>
        </div>

        <!-- Items table -->
        <table>
            <thead>
                <tr>
                    <th>Item No.</th>
                    <th>Item Description</th>
                    <th>Quantity</th>
                    <th>Unit Price</th>
                    <th>Total</th>
                </tr>
            </thead>
            <tbody>
                {% for item in items %}
                <tr>
                    <td>{{ item.item_no }}</td>
                    <td>{{ item.item_name }}</td>
                    <td>{{ item.quantity }}</td>
                    <td>${{ "%.2f"|format(item.unit_price|float) }}</td>
                    <td>${{ "%.2f"|format(item.total_price|float) }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- Terms and totals section -->
        <div class="terms-totals">
            <div class="terms-section">
                <div class="terms-heading">Terms & Conditions:</div>
                <ul class="terms-list">
                    {% for term in terms_and_conditions %}
                    <li>{{ term }}</li>
                    {% endfor %}
                </ul>
                
                {% if notes %}
                <div class="notes-section">
                    <div class="terms-heading">Notes:</div>
                    <p>{{ notes }}</p>
                </div>
                {% endif %}
            </div>
            
            <div class="totals-section">
                <div class="total-row">
                    <span>Subtotal</span>
                    <span>${{ "%.2f"|format(subtotal|float) }}</span>
                </div>
                <div class="total-row">
                    <span>Discount</span>
                    <span>${{ "%.2f"|format(discount|float) }}</span>
                </div>
                <div class="total-row grand-total">
                    <span>Total Quoted Amount</span>
                    <span>${{ "%.2f"|format(total_quoted_amount|float) }}</span>
                </div>
            </div>
        </div>
        
        <!-- Footer with signature -->
        <div class="footer">
            <div class="prepared-by">
                <p><strong>Prepared by:</strong></p>
                <p>{{ issued_by }}</p>
                <p>{{ env.COMPANY_NAME }}</p>
            </div>
        </div>
    </div>
</body>
</html>
